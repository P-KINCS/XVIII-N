<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>üåô MISSION 28 // THE ECHO FAILES</title>
<style>
  :root{ --night:#001f3f; --gold:#d4af37; --ink:#e6d59c; --panel:rgba(255,255,255,.05); }
  html,body{margin:0;background:var(--night);color:var(--gold);font-family:"Garamond",serif}
  .wrap{max-width:960px;margin:0 auto;padding:28px 16px;position:relative;z-index:2}
  h1{margin:6px 0 6px;letter-spacing:1px;font-size:22px}
  .intro{color:var(--ink);opacity:.9;line-height:1.6;margin:4px 0 18px}
  .card{background:var(--panel);border:1px solid rgba(212,175,55,.28);border-radius:12px;padding:14px 14px 18px;margin:18px 0}
  .lyric{margin:6px 0 10px;line-height:1.7}
  .controls{display:flex;flex-direction:column;gap:8px;align-items:center;margin-top:6px}
  label{font-size:14px;color:var(--ink);opacity:.85}
  input{
    border:1px solid rgba(212,175,55,.6);background:#0a223d;color:var(--ink);
    border-radius:8px;padding:9px 12px;font-size:16px;min-width:260px;text-align:center
  }
  .btn{
    border:1px solid var(--gold);background:transparent;color:var(--gold);
    border-radius:8px;padding:8px 14px;cursor:pointer;font-size:15px
  }
  .btn:hover{background:rgba(212,175,55,.10)}
  .btn[disabled]{opacity:.5;cursor:default}
  .explain{min-height:28px;color:var(--ink);white-space:pre-wrap;line-height:1.6;margin-top:8px}
  .hidden{display:none}
  .final{margin:26px auto 10px;white-space:pre-wrap;line-height:1.8;text-align:center;max-width:800px}
  .hr{height:1px;margin:26px 0;background:linear-gradient(90deg,transparent,rgba(212,175,55,.4),transparent)}
  /* twinkling notes layer */
  .notesLayer{position:fixed;inset:0;pointer-events:none;z-index:1}
  .note{
    position:absolute;color:var(--gold);opacity:.6;filter:drop-shadow(0 0 6px rgba(212,175,55,.7));
    animation:twinkle var(--t) ease-in-out infinite;
    will-change:transform, opacity;
  }
  @keyframes twinkle{
    0%,100%{opacity:.25;transform:scale(.9) rotate(0deg)}
    50%{opacity:1;transform:scale(1.2) rotate(5deg)}
  }
  /* falling mode for ending */
  .fall{
    animation: fall 6s linear forwards;
  }
  @keyframes fall{
    0%{transform:translateY(-10vh) scale(1); opacity:.9}
    100%{transform:translateY(110vh) scale(.85); opacity:0}
  }
  /* ending overlay */
  #endingOverlay{
    position:fixed;inset:0;background:rgba(0,0,0,.65);display:none;align-items:center;justify-content:center;z-index:3
  }
</style>
</head>
<body>

<div class="notesLayer" id="notes"></div>

<div class="wrap">
  <h1>üåô MISSION 28 // THE ECHO FAILES</h1>
  <p class="intro">
    ‚ÄúSome memories play like old records ‚Äî soft, imperfect, and unforgettable.<br>
    Let‚Äôs see if you can still hear the echoes, Agent B.‚Äù
  </p>

  <!-- 1 -->
  <div class="card" id="c1">
    <div class="lyric"><em>‚ÄúA kiss is just a kiss, a sigh is just a sigh‚Ä¶‚Äù</em></div>
    <div class="controls">
      <label for="t1">Song title</label>
      <input id="t1" type="text" placeholder="">
      <label for="r1">Artist</label>
      <input id="r1" type="text" placeholder="">
      <button class="btn" onclick="check(1,['as','time','goes','by'],['dooley','wilson'])">Confirm</button>
    </div>
    <div class="explain" id="e1"></div>
  </div>

  <!-- 2 -->
  <div class="card hidden" id="c2">
    <div class="lyric"><em>‚ÄúThe memory of all that ‚Äî no, no, they can‚Äôt take that away from me.‚Äù</em></div>
    <div class="controls">
      <label for="t2">Song title</label>
      <input id="t2" type="text" placeholder="">
      <label for="r2">Artist</label>
      <input id="r2" type="text" placeholder="">
      <button class="btn" onclick="check(2,['they','cant','take','that','away','from','me'],['ella','louis'])">Confirm</button>
    </div>
    <div class="explain" id="e2"></div>
  </div>

  <!-- 3 -->
  <div class="card hidden" id="c3">
    <div class="lyric"><em>‚ÄúFill my heart with song, and let me sing forevermore‚Ä¶‚Äù</em></div>
    <div class="controls">
      <label for="t3">Song title</label>
      <input id="t3" type="text" placeholder="">
      <label for="r3">Artist</label>
      <input id="r3" type="text" placeholder="">
      <button class="btn" onclick="check(3,['fly','me','to','the','moon'],['frank','sinatra'])">Confirm</button>
    </div>
    <div class="explain" id="e3"></div>
  </div>

  <!-- 4 -->
  <div class="card hidden" id="c4">
    <div class="lyric"><em>‚ÄúThough near or far, like a song of love that clings to me‚Ä¶‚Äù</em></div>
    <div class="controls">
      <label for="t4">Song title</label>
      <input id="t4" type="text" placeholder="">
      <label for="r4">Artist</label>
      <input id="r4" type="text" placeholder="">
      <button class="btn" onclick="check(4,['unforgettable'],['nat','natalie','cole'])">Confirm</button>
    </div>
    <div class="explain" id="e4"></div>
  </div>

  <!-- 5 -->
  <div class="card hidden" id="c5">
    <div class="lyric"><em>‚ÄúSome day, when I‚Äôm awfully low‚Ä¶ I‚Äôll just remember you, and the way you look‚Ä¶‚Äù</em></div>
    <div class="controls">
      <label for="t5">Song title</label>
      <input id="t5" type="text" placeholder="">
      <label for="r5">Artist</label>
      <input id="r5" type="text" placeholder="">
      <button class="btn" onclick="check(5,['the','way','you','look','tonight'],['fred','astaire'])">Confirm</button>
    </div>
    <div class="explain" id="e5"></div>
  </div>

  <!-- 6 -->
  <div class="card hidden" id="c6">
    <div class="lyric"><em>‚ÄúHeaven‚Ä¶ I‚Äôm in heaven‚Ä¶‚Äù</em></div>
    <div class="controls">
      <label for="t6">Song title</label>
      <input id="t6" type="text" placeholder="">
      <label for="r6">Artist</label>
      <input id="r6" type="text" placeholder="">
      <button class="btn" onclick="check(6,['cheek','to','cheek'],['fred','astaire'])">Confirm</button>
    </div>
    <div class="explain" id="e6"></div>
  </div>

  <!-- 7 -->
  <div class="card hidden" id="c7">
    <div class="lyric"><em>‚ÄúAnd the moment I can feel that you feel that way too‚Ä¶‚Äù</em></div>
    <div class="controls">
      <label for="t7">Song title</label>
      <input id="t7" type="text" placeholder="">
      <label for="r7">Artist</label>
      <input id="r7" type="text" placeholder="">
      <button class="btn" onclick="check(7,['when','i','fall','in','love'],['nat','king','cole'])">Confirm</button>
    </div>
    <div class="explain" id="e7"></div>
  </div>

  <!-- 8 -->
  <div class="card hidden" id="c8">
    <div class="lyric"><em>‚ÄúI‚Äôve got you deep in the heart‚Ä¶‚Äù</em></div>
    <div class="controls">
      <label for="t8">Song title</label>
      <input id="t8" type="text" placeholder="">
      <label for="r8">Artist</label>
      <input id="r8" type="text" placeholder="">
      <button class="btn" onclick="check(8,['ive','got','you','under','my','skin'],['frank','sinatra'])">Confirm</button>
    </div>
    <div class="explain" id="e8"></div>
  </div>

  <!-- Final page trigger -->
  <div id="finalBlock" class="hidden">
    <div class="hr"></div>
    <p class="final" id="finalText"></p>
  </div>
</div>

<!-- Ending overlay for falling notes -->
<div id="endingOverlay">
  <p class="final" id="endingMessage" style="color:var(--gold);"></p>
</div>

<script>
/* --- helpers --- */
function normalize(s){
  return (s||'').toLowerCase()
    .normalize('NFD').replace(/[\u0300-\u036f]/g,'') // accents
    .replace(/&/g,' and ')
    .replace(/[^a-z0-9\s]/g,' ')  // strip punctuation
    .replace(/\s+/g,' ')          // collapse spaces
    .trim();
}
function containsAllWords(input, requiredWords){
  const w = new Set(normalize(input).split(' ').filter(Boolean));
  return requiredWords.every(req => w.has(normalize(req)));
}
function typewrite(el, txt, spd=22, done){
  el.textContent=''; let i=0;
  (function step(){
    if(i<=txt.length){ el.textContent=txt.slice(0,i); i++; setTimeout(step,spd); }
    else if(done){ done(); }
  })();
}

/* per-answer messages */
const msg = {
  1: "‚ÄúThe beginning of every timeless story ‚Äî a single look, a single kiss.‚Äù\n(As Time Goes By ‚Äî Dooley Wilson, Casablanca)",
  2: "‚ÄúSome things never fade. The way you look at me is one of them.‚Äù\n(They Can‚Äôt Take That Away From Me ‚Äî Ella & Louis)",
  3: "‚ÄúEvery agent needs direction. Mine is always toward you.‚Äù\n(Fly Me to the Moon ‚Äî Frank Sinatra)",
  4: "‚ÄúYou see, some files don‚Äôt need to be archived ‚Äî they just keep playing.‚Äù\n(Unforgettable ‚Äî Nat King Cole & Natalie Cole)",
  5: "‚ÄúIf elegance had a sound, it would be your voice when you say my name.‚Äù\n(The Way You Look Tonight ‚Äî Fred Astaire)",
  6: "‚ÄúHeaven, I‚Äôm in heaven ‚Äî and it looks suspiciously like your arms.‚Äù\n(Cheek to Cheek ‚Äî Fred Astaire)",
  7: "‚ÄúEven agents have hearts ‚Äî mine just confessed.‚Äù\n(When I Fall in Love ‚Äî Nat King Cole)",
  8: "‚ÄúCongratulations, Agent B. The case is solved ‚Äî and the evidence is‚Ä¶ undeniable.‚Äù\n(I‚Äôve Got You Under My Skin ‚Äî Frank Sinatra)"
};

/* check logic for each card */
function check(idx, requiredTitleWords, requiredArtistWords){
  const t = document.getElementById('t'+idx);
  const r = document.getElementById('r'+idx);
  const e = document.getElementById('e'+idx);

  const titleOK  = containsAllWords(t.value, requiredTitleWords);
  const artistOK = containsAllWords(r.value, requiredArtistWords);

  if(!titleOK || !artistOK){ alert('Not quite, Agent. Listen closer.'); return; }

  // lock inputs
  t.disabled = true; r.disabled = true;
  const text = msg[idx];
  typewrite(e, text, 20, () => {
    const next = document.getElementById('c'+(idx+1));
    if(next){ next.classList.remove('hidden'); next.scrollIntoView({behavior:'smooth',block:'start'}); }
    else { showFinal(); }
  });
}

/* final page: start falling notes + type message */
function showFinal(){
  const overlay = document.getElementById('endingOverlay');
  overlay.style.display = 'flex';

  // start falling effect: convert existing notes to falling clones
  startFallingNotes();

  const t = `‚ÄúOur story never needed music to feel like a song.
But every time I hear one‚Ä¶ I still hear you.‚Äù
‚Äî M`;
  typewrite(document.getElementById('endingMessage'), t, 22);
}

/* twinkling notes creation */
(function makeNotes(){
  const layer = document.getElementById('notes');
  const N = 80; // male i jo≈° manje note
  const glyphs = ['‚ô™','‚ô´','ùÑû','‚ô©','‚ô¨','‚ô≠'];
  for(let i=0;i<N;i++){
    const s = document.createElement('span');
    s.className = 'note';
    s.textContent = glyphs[Math.floor(Math.random()*glyphs.length)];
    s.style.left = Math.random()*100+'vw';
    s.style.top  = Math.random()*100+'vh';
    const size = (Math.random()*14)+10; // 10‚Äì24px
    s.style.fontSize = size+'px';
    s.style.opacity = (Math.random()*0.7+0.2).toFixed(2);
    s.style.setProperty('--t',(2.5+Math.random()*3.5)+'s');
    layer.appendChild(s);
  }
})();

/* convert twinkling notes to falling ones on the ending */
function startFallingNotes(){
  const layer = document.getElementById('notes');
  const notes = Array.from(layer.querySelectorAll('.note'));
  // clone a portion to intensify fall
  for(let i=0;i<40;i++){
    const clone = notes[i % notes.length].cloneNode(true);
    clone.style.left = Math.random()*100+'vw';
    clone.style.top  = (-10 - Math.random()*20)+'vh';
    clone.classList.add('fall');
    clone.style.animationDelay = (Math.random()*1.5)+'s';
    layer.appendChild(clone);
  }
  // set all existing to fall from current pos
  notes.forEach((n,idx)=>{
    n.classList.add('fall');
    n.style.animationDelay = (Math.random()*1.2)+'s';
  });
}
</script>
</body>
</html>
